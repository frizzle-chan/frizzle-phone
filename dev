#!/bin/bash
set -e

CONTAINER="frizzle-phone_devcontainer-app-1"

# Kill existing dev server via pid file (try both host and container)
if [ -f frizzle-phone.pid ]; then
    pid=$(cat frizzle-phone.pid)
    kill "$pid" 2>/dev/null || true
    docker exec "$CONTAINER" kill "$pid" 2>/dev/null || true
fi

if [ -f /.dockerenv ]; then
    exec > >(tee frizzle-phone.log) 2>&1
    exec uv run python main.py
else
    devcontainer exec --workspace-folder . uv run python main.py 2>&1 | tee frizzle-phone.log
fi
